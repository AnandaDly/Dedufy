<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dedufy App - Interactive Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        scroll-behavior: smooth;
      }

      /* --- Typing dots --- */
      .dot-flashing {
        position: relative;
        width: 5px;
        height: 5px;
        border-radius: 5px;
        background-color: #555;
        animation: dot-flashing 1s infinite linear alternate;
      }
      .dot-flashing::before,
      .dot-flashing::after {
        content: "";
        position: absolute;
        top: 0;
        width: 5px;
        height: 5px;
        border-radius: 5px;
        background-color: #555;
      }
      .dot-flashing::before {
        left: -10px;
        animation: dot-flashing 1s infinite alternate;
        animation-delay: 0s;
      }
      .dot-flashing::after {
        left: 10px;
        animation: dot-flashing 1s infinite alternate;
        animation-delay: 1s;
      }
      @keyframes dot-flashing {
        0% {
          background-color: #555;
        }
        50%,
        100% {
          background-color: #d1d5db;
        }
      }

      /* --- Transitions --- */
      .fade-slide-enter {
        opacity: 0;
        transform: translateY(20px);
      }
      .fade-slide-enter-active {
        opacity: 1;
        transform: translateY(0);
        transition: all 0.5s ease;
      }
      .fade-slide-exit-active {
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.4s ease;
      }
    </style>
  </head>

  <body class="bg-gradient-to-br from-[#FAFDD6] to-[#AED6CF] min-h-screen">
    <div id="app" class="flex flex-col h-screen overflow-hidden">
      <header
        class="flex justify-between items-center bg-white/70 backdrop-blur-md px-6 py-3 border-b border-gray-200"
      >
        <a
          href="./index.html"
          class="font-bold text-gray-800 text-lg hover:text-teal-600 transition-colors duration-200"
        >
          üéì Dedufy
        </a>
        <button
          id="toggleViewerBtn"
          class="hidden md:inline-flex items-center gap-1 bg-teal-500 hover:bg-teal-600 text-white px-3 py-1.5 rounded-md text-sm transition"
        >
          <span id="toggleViewerIcon">üëÅÔ∏è</span>
          <span id="toggleViewerText">Hide Document</span>
        </button>
      </header>

      <!-- MAIN CONTENT -->
      <main class="flex-1 flex overflow-hidden">
        <!-- Upload Section -->
        <section
          id="material-section"
          class="flex-1 flex items-center justify-center p-8 transition-all duration-500"
        >
          <div
            class="w-full max-w-2xl bg-white/60 backdrop-blur-lg rounded-2xl shadow-2xl p-8 flex flex-col"
          >
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              Upload Your Study Material
            </h2>
            <form id="upload-form">
              <div
                id="dropzone"
                class="flex flex-col items-center justify-center w-full p-8 border-2 border-dashed border-gray-300 rounded-lg bg-white/50 text-gray-500 cursor-pointer hover:border-teal-400 hover:bg-teal-50 transition"
              >
                <p class="text-sm">
                  üìÇ Drag & drop file here or click to select
                </p>
                <p class="text-xs mt-1">Supports: .txt, .pdf, .docx</p>
                <input
                  id="fileInput"
                  type="file"
                  accept=".txt,.pdf,.docx"
                  class="hidden"
                />
              </div>

              <div id="file-preview" class="hidden mt-4">
                <div
                  class="flex items-center justify-between bg-teal-50 border border-teal-200 text-teal-800 text-sm font-medium px-4 py-2 rounded-lg"
                >
                  <div class="flex items-center gap-2">
                    <span id="file-icon">üìÑ</span>
                    <span id="file-name">filename.pdf</span>
                    <span id="file-size" class="text-xs text-gray-500"></span>
                  </div>
                  <button
                    type="button"
                    id="remove-file-btn"
                    class="font-mono font-bold text-lg hover:text-red-500"
                  >
                    √ó
                  </button>
                </div>
              </div>

              <div class="grid md:grid-cols-3 gap-4 mt-6">
                <div>
                  <label
                    for="difficultySelect"
                    class="block text-gray-700 font-medium mb-2"
                    >Difficulty</label
                  >
                  <select
                    id="difficultySelect"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-400"
                  >
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                    <option value="adaptive" selected>Adaptive</option>
                  </select>
                </div>
                <div>
                  <label
                    for="agentModeSelect"
                    class="block text-gray-700 font-medium mb-2"
                    >AI Mode</label
                  >
                  <select
                    id="agentModeSelect"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-400"
                  >
                    <option value="strict">Strict Teacher</option>
                    <option value="friendly" selected>Friendly Tutor</option>
                    <option value="exam">Exam Simulator</option>
                  </select>
                </div>
                <div>
                  <label
                    for="languageSelect"
                    class="block text-gray-700 font-medium mb-2"
                    >Language</label
                  >
                  <select
                    id="languageSelect"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-400"
                  >
                    <option value="indonesian" selected>
                      Bahasa Indonesia
                    </option>
                    <option value="english">English</option>
                  </select>
                </div>
              </div>

              <button
                id="startBtn"
                type="submit"
                class="w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white px-4 py-3 rounded-lg font-semibold transition mt-6 shadow-md hover:shadow-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                üöÄ Start Session
              </button>
            </form>
          </div>
        </section>

        <section
          id="loading-spinner"
          class="hidden flex-1 flex flex-col items-center justify-center p-8 transition-all duration-500"
        >
          <h2 class="text-2xl font-bold text-gray-700 mb-4">
            Menganalisis Dokumen...
          </h2>
          <p class="text-gray-600 mb-8">
            Harap tunggu, ini mungkin perlu beberapa saat.
          </p>
          <div
            class="w-16 h-16 border-8 border-dashed border-teal-500 border-t-transparent rounded-full animate-spin"
          ></div>
        </section>

        <!-- Chat Section -->
        <div
          id="chat-section"
          class="hidden flex flex-1 overflow-hidden transition-all duration-300"
        >
          <!-- Left Viewer -->
          <aside
            id="doc-viewer"
            class="hidden md:flex flex-col w-1/2 border-r border-gray-200 bg-white/70 backdrop-blur-sm transition-all duration-500 ease-in-out"
          >
            <div
              class="p-3 border-b bg-white/80 flex justify-between items-center"
            >
              <h3 class="font-semibold text-gray-700 text-sm">
                üìÑ Document Preview
              </h3>
              <button
                id="openFullDoc"
                class="text-xs text-teal-600 hover:underline"
              >
                Fullscreen
              </button>
            </div>
            <iframe
              id="docPreviewFrame"
              class="flex-1 w-full h-full"
              src=""
              frameborder="0"
            ></iframe>
            <div
              id="docTextPreview"
              class="hidden flex-1 overflow-y-auto p-4 text-sm text-gray-700 whitespace-pre-wrap"
            ></div>
          </aside>

          <!-- Right Chat Panel -->
          <section class="flex flex-col flex-1 bg-white/50 backdrop-blur-md">
            <div
              id="sessionSummary"
              class="flex items-center justify-between bg-white/70 backdrop-blur-sm border-b border-gray-200 px-5 py-2 text-sm text-gray-700"
            >
              <div class="flex flex-col">
                <span
                  ><strong>Mode:</strong>
                  <span id="sessionMode">Friendly Tutor</span></span
                >
                <span
                  ><strong>Difficulty:</strong>
                  <span id="sessionDifficulty">Adaptive</span></span
                >
              </div>
              <div class="flex items-center gap-2">
                <span>üìÑ <span id="sessionFilename">No file</span></span>
              </div>
            </div>

            <div
              id="chatBox"
              class="flex-1 overflow-y-auto p-6 space-y-4"
              aria-live="polite"
            >
              <div id="typing-indicator" class="hidden">
                <div class="flex items-start gap-3">
                  <span
                    class="flex-shrink-0 inline-flex items-center justify-center h-8 w-8 rounded-full bg-gray-200"
                    >ü§ñ</span
                  >
                  <div class="bg-gray-200 p-3 rounded-lg rounded-tl-none">
                    <div class="dot-flashing"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Input -->
            <div
              class="border-t border-gray-200 bg-white/70 backdrop-blur-md p-3 flex gap-2"
            >
              <input
                id="answerInput"
                type="text"
                placeholder="Type your answer..."
                class="flex-1 border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
              <button
                id="sendBtn"
                class="bg-gradient-to-r from-teal-500 to-cyan-500 text-white px-6 py-2 rounded-lg font-semibold transition shadow-md hover:shadow-lg hover:opacity-90"
              >
                Send
              </button>
              <button
                id="restartBtn"
                class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold transition shadow-md hover:shadow-lg"
              >
                ‚Üª
              </button>
            </div>
          </section>
        </div>
      </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <script src="./app.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (typeof ThesisExaminerApp !== "undefined") {
          new ThesisExaminerApp();
        } else {
          console.error(
            "Kelas ThesisExaminerApp tidak ditemukan. Pastikan app.js dimuat dengan benar."
          );
        }
      });
    </script>
  </body>
</html>


